"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7498],{47498:function(e,i,n){n.r(i),n.d(i,{default:function(){return G}});var l=n(62272),t=n(84814),a=n(63119),o=n(29222),r=n(14418),s=n(93701),d=n(204),c=n(23100),u=n(76684),m=n(7754),g=n(88911),h=n(37469),p=n(11163),v=n(67320),f=n(26555),x=n(68295),y=n(35532),I=n(29844),w=n(30923);var C={text:{textTransform:"uppercase",textAlign:"center",cursor:"pointer"}},S=n(14413),k=n(34112),A=n(6832),b=n(63462),P=n(91647),j=n(1568),N=n(69650),T=n(89782),L=n(12433),O=n(3912),E=n(803),B=n(55537),F=n(95145),U=n(70981),_=n(89066);const M=a.object().shape({email:a.string().matches(P.bF,P.T2).required(),password:a.string().required()});var G=e=>{let{onClickForgotPassword:i,onAuthed:n,variant:a="page"}=e;var P;const G=(0,p.useRouter)(),{user:R,setModalExistingEmail:$,setModalScreen:D,setUserLoading:X,login:z,updateAuthProvider:V,setExternalId:q,setSignUpStep:J,setChaseLinkingStatus:W,setIsLinkedToChase:Z,setSecureUserDisplayName:K}=(0,S.aF)(),{setBookmarkLists:H}=(0,T.a)(),{city:Y}=(0,F.j)(),{flow:Q}=R.modal,ee=null===(P=R.modal)||void 0===P?void 0:P.trigger,{existingEmail:ie}=R.modal,{authProvider:ne}=R,{analyticsMeta:le}=(0,k.e)(),te=(0,w.Z)(),{setChaseLinkingLoading:ae}=(0,O.J)(),oe=(0,A.SS)(),{handleAuthError:re,authError:se,clearAuthError:de}=(0,_.ZP)(_.Vo.Signin),ce={email:ie||"",password:""};(0,t.useEffect)((()=>{le.pageSection&&te("Modal Viewed",null,{eventLocation:Q||"Signup Page",modalName:"Signin Options"})}),[le]),(0,t.useEffect)((()=>{(async()=>{if(ne===A.BO.Google||ne===A.BO.Apple){await fe()||(V(null),X(!1))}})()}),[ne]);const ue=(0,t.useCallback)((async function(e,i,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";var t;null===(t=window.branch)||void 0===t||t.setIdentity(n),l&&await(0,B.z)(l);const o="page"!==a&&ee?Q:"Signup Page",r=l?await(0,I.x5)(l):"";i?((0,I.$$)(),te("Account Signup",null,{authMethod:e,eventLocation:o,logged_in:!0,externalId:r})):te("Account Login",null,{authMethod:e,eventLocation:o,logged_in:!0,externalId:r})}),[G.pathname,ee,a,le]),me=e=>{V(e),"Gated Content"===Q?(W("linking"),J("chase-linking")):null==n||n()},ge=(0,h.TA)({initialValues:ce,validationSchema:M,validateOnBlur:!1,validateOnChange:!1,onSubmit:async(e,i)=>{var n,l;X(!0),de();const t=new b.S,a=(0,E.$e)();(0,I.TR)(" Login Flow Started for: "+(0,I.xX)(e.email)+" with trace ID:"+a);const o=await(0,j.$F)(e.email,e.password,a);if(!o.success){const{error:e}=o;return re(e),"3101"===e.errorCode&&"You'll need to reset your password."===(0,j.T3)(e.errorCode)&&pe(ge.values.email),i.setSubmitting(!1),!1}const r=await(0,U.A)(t,{},a);if(!r.success)return re(r.error,_.NI.ProfileService),i.setSubmitting(!1),!1;const{emailAddressIdentifier:s,fullName:d,diningProfileIdentifier:c,analyticsIdentifier:u,legacyProfileIdentifier:m,linkActiveIndicator:g,homeCityCanonicalPathText:h}=r.data.getProfile||{emailAddressIdentifier:"",fullName:"",diningProfileIdentifier:"",analyticsIdentifier:"",legacyProfileIdentifier:"",linkActiveIndicator:!1,homeCityCanonicalPathText:""},p={creationTime:void 0,email:s||"",emailVerified:!0,lastSignInTime:void 0,phoneNumber:null,photoUrl:null,uid:c||"",refreshToken:null,isLoggingOut:!1,legacyId:m,analyticsId:u,homeCity:h||""};return d&&K(d),z(p),await(0,N.U)(p.uid,H),q((null==R||null===(n=R.details)||void 0===n?void 0:n.email)?await(0,I.x5)((null==R||null===(l=R.details)||void 0===l?void 0:l.email.toLowerCase())||""):""),await ue("Email",!1,null===c?"":c,null===s?"":s),me(A.BO.Local),!0===g&&(ae(!1),Z(!0),(0,L.Er)("Chase Account Linked"),W("successful")),i.resetForm(),i.setSubmitting(!1),!0}}),he=ge.values.email&&ge.values.password&&!ge.isSubmitting,pe=async e=>{const i=await(0,j.f8)(e);i.success||"Password reset link sent to registered e-mail"===i.error.errorDescription?($(e),D("reset-password")):re(i.error)},ve=async e=>{de(),X(!0);const i=(0,j.Lh)(e);te("CTA Clicked",null,{eventLabel:"Signin Options",eventLocation:Q||"Signup Page",modal_name:"Signin Options",item_name:"CONTINUE WITH ".concat(e.toUpperCase())});const n=await i;if(!n.success)return re(n.error),V(null),void X(!1);X(!1),V(e)},fe=async()=>{var e;const i=JSON.parse(window.localStorage.getItem("socialAuthToken")||'""'),n={state:null==i?void 0:i.state,code:null==i?void 0:i.code,scope:null==i?void 0:i.scope};window.localStorage.removeItem("socialAuthToken");const l=(0,E.$e)(),t=[];null==(null==n?void 0:n.state)&&t.push("state is ".concat(String(null==n?void 0:n.state))),null==(null==n?void 0:n.code)&&t.push("code is ".concat(String(null==n?void 0:n.code))),null==(null==n?void 0:n.scope)&&t.push("scope is ".concat(String(null==n?void 0:n.scope))),t.length>0&&(0,I.TR)("Social signup Request before callback of AuthService , traceId: ".concat(l,",\n        callbackPostBodyIfNullUndefined: ").concat(t.join(" | ")," "));const a=await(0,j.xv)(ne,n,l);if(!a.success)return re(a.error),!1;var o,r,s;const d={cityIdentifier:null!==(o=null==Y||null===(e=Y.sys)||void 0===e?void 0:e.id)&&void 0!==o?o:"",cityName:null!==(r=null==Y?void 0:Y.displayName)&&void 0!==r?r:"",homeCityCanonicalPathText:null!==(s=null==Y?void 0:Y.path)&&void 0!==s?s:""},c={customAttributeList:(0,I.mX)(),...""!==d.homeCityCanonicalPathText?{cityInfo:d}:{},traceId:l};if((ne===A.BO.Google||ne===A.BO.Apple)&&(c.providerName=ne,ne===A.BO.Apple&&(null==i?void 0:i.user))){var u,m;const e=JSON.parse(i.user);var g,h,p;if((0,I.TR)(" Apple Login Flow Started for: "+(0,I.xX)(e.email)+" with trace ID: "+l),(null==e||null===(u=e.name)||void 0===u?void 0:u.firstName)||(null==e||null===(m=e.name)||void 0===m?void 0:m.lastName))c.fullName=((null==e||null===(g=e.name)||void 0===g?void 0:g.firstName)||"")+" "+((null==e||null===(h=e.name)||void 0===h?void 0:h.lastName)||""),null===(p=c.fullName)||void 0===p||p.trim();c.emailAddressIdentifier=e.email}const v=await(0,U.E)(oe.mutateAsync,{...c});if(!v.success)return re(v.error,_.NI.ProfileService),!1;const{emailAddressIdentifier:f,diningProfileIdentifier:x,providerName:y,analyticsIdentifier:w,legacyProfileIdentifier:C,linkActiveIndicator:S,homeCityCanonicalPathText:k}=(null==v?void 0:v.data.createProfile)||{emailAddressIdentifier:"",diningProfileIdentifier:"",providerName:"",analyticsIdentifier:"",legacyProfileIdentifier:"",linkActiveIndicator:!1,homeCityCanonicalPathText:""},b={creationTime:void 0,email:f||"",emailVerified:!0,lastSignInTime:void 0,phoneNumber:null,photoUrl:null,uid:x||"",refreshToken:null,isLoggingOut:!1,legacyId:C,analyticsId:w,homeCity:k||""};return V(y||""),z(b),await(0,N.U)(null==b?void 0:b.uid,H),await ue(ne===A.BO.Google?"Google":"Apple",!1,null===x?"":x,null===f?"":f),me(ne),!0===S&&(ae(!1),Z(!0),W("successful"),(0,L.Er)("Chase Account Linked")),!0};return(0,l.jsxs)(l.Fragment,{children:["modal"===a&&(0,l.jsx)(o.z,{"aria-label":"Back",variant:"unstyled",position:"absolute",top:6,left:4,boxSize:8,display:"flex",onClick:()=>D("sign-up"),children:(0,l.jsx)(v.Xd,{boxSize:6,fill:"gray100"})}),(0,l.jsxs)(r.X,{as:"h2",pb:8,"data-testid":"login_test",children:["Welcome ",(0,l.jsx)(s.m.span,{color:"primary",children:"back"}),"!"]}),(0,l.jsxs)(d.k,{direction:"column",children:[(0,l.jsx)(c.xu,{as:"form",onSubmit:ge.handleSubmit,"data-testid":"loginForm-fieldBox",children:(0,l.jsxs)(d.k,{direction:"column",children:[(0,l.jsxs)(u.K,{spacing:8,mb:8,children:[(0,l.jsx)(x.Wi,{name:"email",value:ge.values.email,placeholder:"Email",onChange:ge.handleChange,errorMessage:ge.errors.email,"data-testid":"loginForm-emailInput"}),(0,l.jsx)(x.RS,{name:"password",value:ge.values.password,placeholder:"Password",onChange:ge.handleChange,"data-testid":"loginForm-passwordInput"})]}),(0,l.jsx)(o.z,{type:"submit",isDisabled:!he,variant:"primary",mb:4,"data-testid":"loginForm-logInButton",children:"Log in"}),(0,l.jsx)(y.Z,{href:"/forgot-password",variant:"unstyled",sx:C.text,color:"primary",onClick:e=>{i&&(e.preventDefault(),$(""),i())},children:"I forgot my password"})]})}),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.lX,{children:"or"}),se&&(0,l.jsx)(m.M,{children:(0,l.jsxs)(d.k,{align:"center",color:"red50",mb:4,children:[(0,l.jsx)(v.Ry,{}),(0,l.jsx)(g.x,{color:"currentColor",pl:4,children:se})]})}),(0,l.jsxs)(u.K,{spacing:"4",children:[(0,l.jsx)(f.$d,{icon:(0,l.jsx)(v._8,{}),onClick:async()=>ve(A.BO.Google),children:"Continue with Google"}),(0,l.jsx)(f.$d,{icon:(0,l.jsx)(v.qw,{}),onClick:async()=>ve(A.BO.Apple),children:"Continue with Apple"})]})]})]})]})}}}]);